<html>
<head>
<title>Would you rather??</title>	
<meta property="og:title" content="Would you rather a pokemon?">
<meta property="og:description" content="You have to choose one or the other. Sorry.">
<meta property="og:image" content="https://cdn.discordapp.com/emojis/996157223581515806.webp">
</head>

<!-- Hi mom :3> -->

<body>
<style>

</style>
<script src="../scores.js"></script>

<script>

var pokemonlist = averagelist;
var accepted = [];
var rejected = [];

//---------------
function rand(max) {
  max = Math.floor(max);
  return Math.floor(Math.random() * max);
}

function getParameter(s,p)
{
	result = s.substring(s.search(p)+p.length+1,s.length);
	result = result.substring(0,result.search(";"));
	return result;
}

function shuffle(array)
{
	return array.sort(() => Math.random() - 0.5);
}

//---------------

urlbase = "https://assets.pokemon.com/assets/cms2/img/pokedex/full/";

var resultA = "";
var resultB = "";
var round = 1;
var votes = 0;
var started = false;
var finished = false;
shuffle(pokemonlist);

function SetA(i)
{
	resultA = pokemonlist[i];
	document.getElementById('GenA').src = "../ball.png";
	document.getElementById('GenA').src = urlbase + getParameter(resultA,"file");
	document.getElementById('ScoreA').innerText = getParameter(resultA,"name");
}
function SetB(i)
{
	resultB = pokemonlist[i];
	document.getElementById('GenB').src = "../ball.png";
	document.getElementById('GenB').src = urlbase + getParameter(resultB,"file");
	document.getElementById('ScoreB').innerText = getParameter(resultB,"name");
}

function refresh()
{
	document.getElementById('GenA').src = "../ball.png";
	document.getElementById('GenB').src = "../ball.png";
	
	document.getElementById('GenA').src = urlbase + getParameter(resultA,"file");
	document.getElementById('ScoreA').innerText = getParameter(resultA,"name");
	document.getElementById('GenB').src = urlbase + getParameter(resultB,"file");
	document.getElementById('ScoreB').innerText = getParameter(resultB,"name");
	if (round>1) document.getElementById('round').innerHTML = "Round " + round;
	else document.getElementById('round').innerHTML = "&nbsp;";
}

function winner()
{
	document.getElementById('GenA').src = urlbase + getParameter(pokemonlist[0],"file");
	document.getElementById('ScoreA').innerText = getParameter(pokemonlist[0],"name");
	document.getElementById('rightside1').remove();
	document.getElementById('rightside2').remove();
	document.getElementById('round').innerText = "We have a winner!";
	document.getElementById('target').innerText = "You would rather:";
	document.getElementById('DetailsB').innerText = "After "+votes+" votes, it has been decided.";
	finished = true;
	started = false;
}

function popmore()
{
	if (pokemonlist.length < 2)
	{		
		if (pokemonlist.length == 1) accepted.push(pokemonlist.pop());
		pokemonlist = accepted;
		accepted = [];
		shuffle(pokemonlist);
		round++;
	}
	if (pokemonlist.length > 1)
	{
		resultA = pokemonlist.pop();
		resultB = pokemonlist.pop();
		refresh();
	}
	else
	{
		winner();
	}
}

function chooseA()
{
	if (started)
	{
		votes++;
		document.getElementById('DetailsB').innerHTML = "You just chose "+getParameter(resultA,"name")+" over "+getParameter(resultB,"name");
		accepted.push(resultA);
		rejected.push(resultB);
		popmore();
		if (!(finished)) document.getElementById('DetailsB').innerHTML += "<br>" +pokemonlist.length+" pokemon left this round."
	}
}

function chooseB()
{
	if (started)
	{
		votes++;
		document.getElementById('DetailsB').innerHTML = "You just chose "+getParameter(resultB,"name")+" over "+getParameter(resultA,"name");
		rejected.push(resultA);
		accepted.push(resultB);
		popmore();
		if (!(finished)) document.getElementById('DetailsB').innerHTML += "<br>" +pokemonlist.length+" pokemon left this round."
	}
}

window.onkeyup = function(e) {
    var key = e.keyCode ? e.keyCode : e.which;
    if (key == 37) chooseA();
    else if (key == 39) chooseB();    
}

//---------------
//start

function prune(target)
{
	newlist = [];
	for(i=0;i<pokemonlist.length;i++)
	{
		score = (getParameter(pokemonlist[i],"base")-0) + (getParameter(pokemonlist[i],"elements")-0);
		if (target<0) score = score*-1;
		if (score >= target) newlist.push(pokemonlist[i]);
	}
	pokemonlist = newlist;
}


function difficulty(i,st)
{
	prune(i);
	document.getElementById("target").innerHTML = "Would you rather...";
	document.getElementById('DetailsB').innerHTML += "<br>You have " +pokemonlist.length+" pokemon to choose from.";
	document.getElementById('difficultyBar').innerHTML = "Choosing from "+st;
	popmore();
	started = true;
}

</script>

<style>
p,dialog
{
    margin-bottom: 0px;
    margin-top: 0px;
    font: 24px Trebuchet MS,sans-serif;
}
p.help
{
	margin-bottom: 4px;
    margin-top: 16px;
    font: 16px Trebuchet MS,sans-serif;
}
#total
{
	font: bold 36px Trebuchet MS,sans-serif;
}
</style>

<div class="random_selectors" align="center">
	
	<p align="center" id="difficultyBar" style="font-size: 16px;"><span style="font-size: 36px;"><b>Choose a difficulty:</b></span><br>
	<span style="font-size: 12px"><b>Warning!</b> All of these except furbait and anti-furbait probably require an entire
	afternoon to complete (Because of how many pokemon there are to choose from).<br>If you want a better way to find out your favorite pokemon, <a href="https://www.dragonflycave.com/favorite.html">click here!</a>.<br>Also the data is grabbed automatically based on score
	tresholds from <a href="https://elpatrixf.com/pokefusion/">my previous experiment</a>.</span><br><br>
	[<a href=# onclick="difficulty( 8.5,'furbait pokemon only');" title="Combined score higher than 8.5"><b>Furbait</b></a>], 
	[<a href=# onclick="difficulty(   7,'furbait (loosely) pokemon only');" title="Combined score higher than 7"><b>Extended</b></a>], 
	[<a href=# onclick="difficulty( 6.5,'generally good looking pokemon');" title="Combined score higher than 6.5">General</a>], 
	[<a href=# onclick="difficulty( 4.5,'half the pokemon (the better ones)');" title="Combined score higher than 4.5">Top half</a>], 
	[<a href=# onclick="difficulty(   0,'all pokemon available');" title="All pokemon no matter their score">All pokemon</a>], 
	[<a href=# onclick="difficulty(-4.5,'half the pokemon (the worse ones)');" title="Combined score lower than 4.5">Hard mode</a>], 
	[<a href=# onclick="difficulty(  -2,'the most anti-furbait pokemon :)');" title="Combined score lower than 2"><b>Anti-furbait</b></a>]</p>
	<p align="center" id="round"></p>
	<p align="center" id="target">&nbsp;</p>
	<table border="0" cellspacing="0" cellpadding="0" id="bigtable">
		<tr>
			<td>
				<p align="center"><a href="#"><img id="GenA" src="../ball.png" draggable="false" width=475px onclick="chooseA();"></a></p>	
				<p align="center" id="ScoreA">&nbsp;</p>
			</td>
			<td id="rightside1">
				<p style="font-size: 132px">or</p>
			</td>
			<td id="rightside2">
				<p align="center"><a href="#"><img id="GenB" src="../ball.png" draggable="false" width=475px onclick="chooseB();"></a></p>	
				<p align="center" id="ScoreB">&nbsp;</p>
			</td>
		</tr>
	</table>
	<p align="center" style="font-size:12px;opacity:0.6;" id="DetailsB">You have to choose one.</p>
	<p id="bottom" align="center"></p>
	
	<p align="right" style="font-size:12px;opacity:0.3;">By @<a href="https://twitter.com/elpatrixf">elpatrixf</a>. Version 0.1.1<br>pokémon ©1995 pokémon, nintendo, game freak, creatures
	</p>
	</div>

<script>	
	updateScore();
</script>

</body>
</html>